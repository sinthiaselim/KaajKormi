{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width: 800px; margin-top: 2rem;">
    <div class="card" style="display: flex; flex-direction: column; height: 80vh;">
        <!-- Header -->
        <div
            style="padding: 1rem; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="{{ url_for('view_messages') }}" class="btn btn-outline" style="padding: 0.5rem 0.75rem;">
                    <i class="fa-solid fa-arrow-left"></i>
                </a>
                <div>
                    <h3 style="margin: 0;">{{ other_user.name }}</h3>
                    <span class="text-muted" style="font-size: 0.875rem;">{{ other_user.role|title }}</span>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div id="chat-messages"
            style="flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; background: #f9fafb;">
            {% for msg in messages %}
            <div
                style="display: flex; justify-content: {{ 'flex-end' if msg.sender_id == session['user_id'] else 'flex-start' }};">
                <div style="
                        max-width: 70%;
                        padding: 0.75rem 1rem;
                        border-radius: 1rem;
                        position: relative;
                        {{ 'background: var(--primary-color); color: white; border-bottom-right-radius: 0;' if msg.sender_id == session['user_id'] else 'background: white; border: 1px solid var(--border-color); border-bottom-left-radius: 0;' }}
                    ">
                    <div style="font-size: 1rem;">{{ msg.message }}</div>
                    <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.8; text-align: right;">
                        {{ msg.timestamp.strftime('%I:%M %p') }}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-muted" style="text-align: center; margin-top: 2rem;">
                No messages yet. Say hello! ðŸ‘‹
            </div>
            {% endfor %}
        </div>

        <!-- Input Area -->
        <div style="padding: 1rem; border-top: 1px solid var(--border-color); background: white;">
            <form action="{{ url_for('send_message') }}" method="POST" style="display: flex; gap: 1rem;">
                <input type="hidden" name="receiver_id" value="{{ other_user.id }}">
                <input type="text" name="message" class="form-control" placeholder="Type a message..." required
                    autofocus autocomplete="off" style="border-radius: 2rem;">
                <button type="submit" class="btn btn-primary"
                    style="border-radius: 50%; width: 48px; height: 48px; padding: 0; display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    // Auto-scroll to bottom
    const chatBox = document.getElementById('chat-messages');
    chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}